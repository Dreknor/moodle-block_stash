define(["jquery","core/templates","block_stash/counselor","block_stash/item-dialogue","block_stash/drop","core/notification","block_stash/trade"],function(a,b,c,d,e,f,g){function h(b){this._node=a(b),this._setUp()}return h.prototype._node=null,h.prototype._setUp=function(){c.on(e.prototype.EVENT_PICKEDUP,this._dropPickedUpListener.bind(this)),c.on(g.prototype.EVENT_TRADE,this._dropPickedUpListener.bind(this))},h.prototype.containsItem=function(a){return this.getTradeItemNode(a).length>0},h.prototype._dropPickedUpListener=function(a,b){var c=b.useritem;this.containsItem(c.getItem().get("id"))&&this.updateTradeItemUserQuantity(c)},h.prototype.getTradeItemNode=function(a){return this._node.find(".removed-items[data-itemid="+a+"]")},h.prototype.updateTradeItemUserQuantity=function(c){var d=c.getItem().get("id"),e=this.getTradeItemNode(d),g=parseInt(c.get("quantity"),10),h=parseInt(e.attr("data-quantity"),10),i=e.parent().attr("data-tradeid"),j=c.getItem().get("name"),k=g>=h,l={enoughitems:k,itemid:d,quantity:h,name:j,userquantity:g};b.render("block_stash/tradeitem_detail",l).done(function(c,e){b.replaceNodeContents(a(".block-stash-trade-item-"+d+'[data-tradeid="'+i+'"]'),c,e)}.bind(this)).fail(f.exception)},h});