define(["jquery","core/templates","block_stash/counselor","block_stash/drop"],function(a,b,c,d){function e(b){this._node=a(b),c.on(d.prototype.EVENT_PICKEDUP,this._dropPickedUpListener.bind(this))}return e.prototype._node=null,e.prototype._userItemTemplate="block_stash/user_item",e.prototype.addUserItem=function(c){return this._renderUserItem(c).then(function(d,e){a(d).data("useritem",c),this._node.find(".item-list").append(d),b.runTemplateJS(e)}.bind(this))},e.prototype.containsItem=function(a){return this.getUserItemNode(a).length>0},e.prototype._dropPickedUpListener=function(a,b){var c=b.useritem;this.containsItem(c.getItem().get("id"))?this.updateUserItemQuantity(c):this.addUserItem(c).then(function(){this._node.find(".alert").hide()}.bind(this))},e.prototype.getUserItemNode=function(a){return this._node.find(".block-stash-item[data-id="+a+"]")},e.prototype._renderUserItem=function(a){return b.render(this._userItemTemplate,{item:a.getItem().getData(),useritem:a.getData()})},e.prototype.updateUserItemQuantity=function(a){var b=this.getUserItemNode(a.getItem().get("id")),c=b.find(".item-quantity"),d=a.get("quantity"),e=parseInt(c.text(),10);c.text(d),b.removeClass("item-quantity-"+e),b.addClass("item-quantity-"+d)},e});